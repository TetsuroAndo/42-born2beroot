# ボーナスパートのセットアップ手順

## 1. パーティション設定

システムには以下のようなパーティション構成が設定されています：

- `/boot/efi` (512MB)
- `/boot` (488MB)
- 暗号化された論理ボリューム（31GB）
  - root (6.1GB)
  - var (2.4GB)
  - swap_1 (976MB)
  - tmp (484MB)
  - home (11.1GB)
  - srv (3GB)
  - var-log (4GB)

### 追加パーティションの作成

1. `/srv`用の論理ボリューム作成（5GB）
2. `/var/log`用の論理ボリューム作成（5GB）
3. 各ボリュームにファイルシステム（ext4）を作成
4. マウントポイントの作成と`/etc/fstab`への追加

## 2. ネットワーク設定

以下のポートを開放：

- 80 (HTTP)
- 443 (HTTPS)

## 3. Web サーバー設定（Lighttpd）

1. Apache2 と Nginx が存在しないことを確認
2. Lighttpd の設定：
   - FastCGI モジュールの有効化
   - PHP-FastCGI モジュールの有効化
   - サービスの再読み込み

## 4. データベース設定（MariaDB）

1. セキュリティ設定の実行
2. WordPress データベースの作成：
   - データベース名：`wordpress`
   - ユーザー名：`wpuser`
   - パスワード：`Password-Is-42`
   - 必要な権限の付与

## 5. WordPress 設定

1. WordPress のダウンロードと展開
2. 適切な権限設定：
   - 所有者：`www-data`
   - パーミッション：755
3. 設定ファイル（wp-config.php）の設定：
   - データベース接続情報
   - 認証キーとソルト

## 6. Web サーバーの最終設定

1. WordPress サイト用の設定ファイル作成
2. PHP-FPM の起動と有効化
3. Lighttpd の再起動と動作確認

## 7. 追加サービス（Tailscale）

セキュアな VPN アクセス用に Tailscale をインストールし、認証キーを使用して設定

# Web サーバーとアプリケーションの詳細設定解説

## 3. Web サーバー設定（Lighttpd）の詳細

### Lighttpd とは

- 軽量で高速な Web サーバー
- メモリ使用量が少なく、小規模サーバーに最適
- 設定がシンプルで管理が容易

### モジュール設定

1. FastCGI モジュール

   - 動的コンテンツを効率的に処理
   - Web サーバーとアプリケーション間の通信を最適化
   - プロセス管理による安定性の向上

2. PHP-FastCGI モジュール
   - PHP スクリプトの実行を高速化
   - プロセスを再利用することでリソース効率を改善
   - セキュリティの向上（PHP プロセスの分離）

# FastCGI と PHP-FastCGI モジュールの詳細解説

## FastCGI モジュール（mod_fastcgi）

### 基本概念

- CGI（Common Gateway Interface）を拡張した仕組み
- Web サーバーと PHP などの外部アプリケーション間の通信プロトコル
- プロセスを常駐させることで、従来の CGI の問題点を解決

### 主な特徴

1. プロセス管理

   - プロセスを再利用（常駐化）
   - リクエストごとにプロセスを生成しない
   - システムリソースの効率的な使用

2. 高速な処理

   - プロセス起動のオーバーヘッドを削減
   - 接続をキープアライブ
   - メモリ使用の最適化

3. スケーラビリティ
   - 同時接続数の管理
   - 負荷に応じたプロセス数の調整
   - システムリソースの効率的な分配

## PHP-FastCGI モジュール（mod_fastcgi_php）

### 基本概念

- FastCGI の PHP 特化版
- PHP-FPM（PHP FastCGI Process Manager）と連携
- PHP スクリプトの実行に特化した最適化

### 主な特徴

1. PHP 処理の最適化

   - PHP プロセスのプール管理
   - リクエストの効率的な振り分け
   - メモリキャッシュの活用

2. セキュリティ強化

   - PHP プロセスの分離
   - ユーザー権限の分離
   - リソースの制限と監視

3. 設定の柔軟性
   - プロセス数の動的調整
   - タイムアウト設定
   - メモリ制限の設定

### FastCGI と PHP-FPM の連携の利点

1. パフォーマンス面

   - リクエスト処理の高速化
   - システムリソースの効率的な使用
   - 同時接続処理の最適化

2. 安定性

   - プロセスの自動再起動
   - エラー時の適切な処理
   - 負荷分散の実現

3. 運用管理
   - 詳細なログ記録
   - プロセス状態の監視
   - 問題の早期発見と対応

### 従来の mod_php との比較

1. メリット

   - メモリ使用量の削減
   - セキュリティの向上
   - スケーラビリティの向上

## 4. データベース設定（MariaDB）の詳細

### セキュリティ設定の重要性

- root パスワードの設定
- 匿名ユーザーの削除
- リモート root ログインの禁止
- テストデータベースの削除
- これらにより、基本的なセキュリティリスクを軽減

### WordPress データベース設定

- 専用データベースの作成により、データの分離と管理が容易に
- 専用ユーザーの作成でアクセス制御を強化
- 最小権限の原則に基づく権限設定
  - データベース`wordpress`のみにアクセス可能
  - ローカルホストからのアクセスのみを許可

## 5. WordPress 設定の詳細

### インストールと展開

- 公式サイトから最新版を取得し、セキュリティを確保
- 圧縮ファイルの削除でディスク容量の節約

### 権限設定の重要性

1. 所有者設定（www-data）

   - Web サーバープロセスがファイルに適切にアクセス可能
   - セキュリティ上の理由で一般ユーザーではなく Web サーバー用ユーザーを使用

2. パーミッション設定（755）
   - 所有者に全権限（7: 読み書き実行）
   - グループとその他に読み取りと実行権限（5）
   - これにより、セキュリティを確保しながら必要な操作が可能

### wp-config.php 設定

- データベース接続情報の安全な管理
- 認証キーとソルトによるセッションセキュリティの強化
- WordPress の基本動作に必要な設定を一元管理

## 6. Web サーバーの最終設定の詳細

### WordPress 用設定ファイル

- サイトのドキュメントルート設定
- PHP ファイルの処理設定
- FastCGI の設定による効率的な PHP 実行

### PHP-FPM の役割

- PHP プロセスの効率的な管理
- リソースの最適化
- スケーラビリティの向上

### 動作確認の重要性

- 設定の正確性を確認
- エラーの早期発見
- サービスの安定性を確保
